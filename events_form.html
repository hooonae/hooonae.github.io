<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>전시 일정 추가</title>
    
    <!-- ✅ Cloudinary & Firebase -->
    <script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-database-compat.js"></script>

    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: #F8F1E9;
            margin: 0;
            padding: 20px;
            text-align: center;
        }
        .container {
            max-width: 400px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.2);
            text-align: left;
        }
        h1 { font-size: 22px; text-align: center; }
        .input-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }
        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
        }
        .image-preview {
            width: 100%;
            height: auto;
            max-height: 200px;
            display: none;
            margin: 10px 0;
            border-radius: 5px;
        }
        .btn {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        .upload-btn {
            background: #3498db;
            color: white;
            margin-bottom: 10px;
        }
        .submit-btn {
            background: green;
            color: white;
        }
    </style>
</head>
<body>

    <h1>전시 일정 추가</h1>

    <div class="container">
        <div class="input-group">
            <label>전시 제목</label>
            <input type="text" id="title">
        </div>
        <div class="input-group">
            <label>시작 날짜</label>
            <input type="date" id="startDate">
        </div>
        <div class="input-group">
            <label>종료 날짜</label>
            <input type="date" id="endDate">
        </div>
        <div class="input-group">
            <button class="btn upload-btn" id="uploadWidget">이미지 업로드</button>
            <img id="imagePreview" class="image-preview">
        </div>
        <button class="btn submit-btn" onclick="addEvent()">등록</button>
    </div>

    <script>
        const cloudName = "dddmgnzlu";
        const uploadPreset = "firebase_uploads";
        let imageUrl = "";

        // ✅ Cloudinary 업로드 버튼 클릭 시 "파일 선택 창" 바로 열리게 수정
        document.getElementById("uploadWidget").addEventListener("click", function() {
            cloudinary.openUploadWidget({
                cloud_name: cloudName,
                upload_preset: uploadPreset,
                sources: ["local"], // "My Files" 등 불필요한 옵션 제거
                multiple: false,
                cropping: false
            }, function(error, result) {
                if (!error && result.event === "success") {
                    imageUrl = result.info.secure_url;
                    document.getElementById("imagePreview").src = imageUrl;
                    document.getElementById("imagePreview").style.display = "block";
                }
            });
        });

        // ✅ Firebase에 데이터 저장
        function addEvent() {
            let title = document.getElementById("title").value;
            let startDate = document.getElementById("startDate").value;
            let endDate = document.getElementById("endDate").value;

            if (!title || !startDate || !endDate) {
                alert("모든 항목을 입력하세요.");
                return;
            }

            let newEvent = { title, startDate, endDate, image: imageUrl };

            firebase.database().ref("events").push(newEvent)
                .then(() => {
                    alert("일정이 추가되었습니다!");
                    window.location.href = "events.html";
                })
                .catch(error => console.error("추가 실패:", error));
        }
    </script>

</body>
</html>
