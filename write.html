<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>게시글 상세보기</title>

    <!-- ✅ Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-database-compat.js"></script>

    <!-- ✅ 구글 폰트 및 아이콘 -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f8f9fa; padding: 20px; }
        .container { max-width: 700px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .btn { padding: 8px 12px; cursor: pointer; border-radius: 5px; margin: 5px; }
        .btn-edit { background: #007bff; color: white; }
        .btn-delete { background: #dc3545; color: white; }
        .comment { padding: 10px; background: #f1f1f1; margin-top: 5px; border-radius: 5px; display: flex; justify-content: space-between; }
    </style>
</head>
<body>

<div class="container">
    <h1 id="post-title">📌 게시글 제목</h1>
    <p>👤 <span id="post-author"></span> | 📅 <span id="post-date"></span></p>
    <img id="post-image" src="" style="max-width:100%;display:none;border-radius:10px;margin:10px 0;">
    <p id="post-content"></p>

    <div>
        <button class="btn btn-edit" onclick="location.href=`write.html?name=${sectionName}&id=${postId}`">✏ 수정</button>
        <button class="btn btn-delete" onclick="deletePost()">🗑 삭제</button>
    </div>

    <div>
        <h3>💬 댓글</h3>
        <input type="text" id="commentAuthor" placeholder="작성자" style="width:100%;margin-top:10px;padding:8px;border-radius:5px;border:1px solid #ddd;">
        <input type="text" id="commentInput" placeholder="댓글 입력" style="width:100%;margin-top:5px;padding:8px;border-radius:5px;border:1px solid #ddd;">
        <button onclick="addComment()" class="btn btn-edit">댓글 등록</button>
        <div id="commentList"></div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAwXlQewHZxYLbZMkoKhm9HYsj6R8oPEpA",
        authDomain: "museum-web-370cd.firebaseapp.com",
        databaseURL: "https://museum-web-370cd-default-rtdb.firebaseio.com",
        projectId: "museum-web-370cd",
        storageBucket: "museum-web-370cd.appspot.com",
        messagingSenderId: "154810876093",
        appId: "1:154810876093:web:d9cc427254abfb609e37d4"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const params = new URLSearchParams(window.location.search);
    const sectionName = params.get("name");
    const postId = params.get("id");

    function loadPost() {
        db.ref(`posts/${sectionName}/${postId}`).once("value", snap => {
            if (!snap.exists()) { alert("게시글이 없습니다."); return; }
            const post = snap.val();
            document.getElementById("post-title").innerText = post.title;
            document.getElementById("post-author").innerText = post.author;
            document.getElementById("post-date").innerText = new Date(post.date).toLocaleString();
            document.getElementById("post-content").innerText = post.content;
            if(post.imageUrl) {
                const img = document.getElementById("post-image");
                img.src = post.imageUrl;
                img.style.display = "block";
            }
            loadComments();
        });
    }

    function deletePost() {
        if(confirm("정말 삭제하시겠습니까?")){
            db.ref(`posts/${sectionName}/${postId}`).remove().then(() => location.href=`section.html?name=${sectionName}`);
        }
    }

    function editPost(){
        location.href = `write.html?name=${sectionName}&id=${postId}`;
    }

    function addComment(){
        const author = document.getElementById("commentAuthor").value.trim();
        const text = document.getElementById("commentInput").value.trim();
        if(!author || !text){alert("작성자와 댓글을 입력하세요.");return;}

        db.ref(`comments/${postId}`).push({author,text}).then(()=>{
            document.getElementById("commentAuthor").value='';
            document.getElementById("commentInput").value='';
            loadComments();
        });
    }

    function deleteComment(cid){
        db.ref(`comments/${postId}/${cid}`).remove().then(loadComments);
    }

    function loadComments(){
        const commentList=document.getElementById("commentList");
        commentList.innerHTML="";
        db.ref(`comments/${postId}`).once("value",snap=>{
            snap.forEach(c=>{
                const comment=c.val();
                commentList.innerHTML+=`<div class="comment">${comment.author}: ${comment.text}<button onclick="deleteComment('${c.key}')" class="btn-delete">❌</button></div>`;
            });
        });
    }

    loadPost();
</script>

</body>
</html>
