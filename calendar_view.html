<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>달력</title>
    <script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; max-width: 400px; margin: auto; }
        .day { border: 1px solid #ccc; padding: 10px; min-height: 90px; text-align: center; position: relative; }
        .name-list { list-style-type: none; padding: 0; margin: 0; font-size: 12px; }
        .name-item { display: flex; justify-content: space-between; align-items: center; background: #f0f0f0; padding: 3px 5px; margin: 2px 0; border-radius: 5px; }
        .delete-btn { cursor: pointer; color: red; font-size: 14px; }
        .name-input { width: 90%; margin-top: 5px; display: block; }
        .weekdays { display: grid; grid-template-columns: repeat(7, 1fr); font-weight: bold; margin-bottom: 5px; }
    </style>
</head>
<body>

<h2>월간 일정 (Firebase 저장)</h2>

<select id="monthSelect" onchange="updateCalendar()">
    <option value="1">1월</option>
    <option value="2">2월</option>
    <option value="3" selected>3월</option>
    <option value="4">4월</option>
    <option value="5">5월</option>
    <option value="6">6월</option>
    <option value="7">7월</option>
    <option value="8">8월</option>
    <option value="9">9월</option>
    <option value="10">10월</option>
    <option value="11">11월</option>
    <option value="12">12월</option>
</select>

<div class="weekdays">
    <div>월</div> <div>화</div> <div>수</div> <div>목</div> <div>금</div> <div>토</div> <div>일</div>
</div>

<div class="calendar" id="calendar"></div>

<script>
    // 🔥 Firebase 설정
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_AUTH_DOMAIN",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_STORAGE_BUCKET",
        messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
        appId: "YOUR_APP_ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    function saveName(month, day, input) {
        let name = input.value.trim();
        if (!name) return;
        
        let docRef = db.collection("calendar").doc(`${month}-${day}`);

        docRef.get().then(doc => {
            let names = doc.exists ? doc.data().names : [];
            if (names.length < 5) {
                names.push(name);
                docRef.set({ names }).then(() => {
                    input.value = "";  // 입력 초기화
                    updateNameList(month, day);
                });
            } else {
                alert("최대 5명까지 입력 가능합니다!");
            }
        });
    }

    function removeName(month, day, index) {
        let docRef = db.collection("calendar").doc(`${month}-${day}`);

        docRef.get().then(doc => {
            if (doc.exists) {
                let names = doc.data().names;
                names.splice(index, 1);
                docRef.set({ names }).then(() => {
                    updateNameList(month, day);
                });
            }
        });
    }

    function updateNameList(month, day) {
        let docRef = db.collection("calendar").doc(`${month}-${day}`);
        let dayCell = document.querySelector(`[data-month="${month}"][data-day="${day}"]`);
        if (!dayCell) return;

        let nameList = dayCell.querySelector(".name-list");
        nameList.innerHTML = "";

        docRef.get().then(doc => {
            if (doc.exists) {
                doc.data().names.forEach((name, index) => {
                    let listItem = document.createElement("li");
                    listItem.classList.add("name-item");
                    listItem.innerHTML = `${name} <span class="delete-btn" onclick="removeName(${month}, ${day}, ${index})">✖</span>`;
                    nameList.appendChild(listItem);
                });
            }
        });
    }

    function loadNames(month) {
        db.collection("calendar").get().then(snapshot => {
            snapshot.forEach(doc => {
                let [docMonth, docDay] = doc.id.split("-");
                if (parseInt(docMonth) === month) {
                    updateNameList(docMonth, docDay);
                }
            });
        });
    }

    function createCalendar(year, month) {
        const calendar = document.getElementById("calendar");
        calendar.innerHTML = "";

        const firstDay = new Date(year, month - 1, 1).getDay();
        const daysInMonth = new Date(year, month, 0).getDate();
        const adjustedFirstDay = firstDay === 0 ? 6 : firstDay - 1;

        for (let i = 0; i < adjustedFirstDay; i++) {
            const emptyCell = document.createElement("div");
            emptyCell.classList.add("day");
            calendar.appendChild(emptyCell);
        }

        for (let day = 1; day <= daysInMonth; day++) {
            const dayCell = document.createElement("div");
            dayCell.classList.add("day");
            dayCell.setAttribute("data-month", month);
            dayCell.setAttribute("data-day", day);
            dayCell.innerHTML = `<div>${day}</div>
                <ul class="name-list"></ul>
                <input type="text" class="name-input" placeholder="이름 입력" 
                    onkeydown="if(event.key==='Enter') { saveName(${month}, ${day}, this); return false; }">`;
            calendar.appendChild(dayCell);
        }

        loadNames(month);
    }

    function updateCalendar() {
        const month = parseInt(document.getElementById("monthSelect").value);
        createCalendar(2025, month);
    }

    createCalendar(2025, 3);
</script>

</body>
</html>
