<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§›ì§‘ ì¶”ì²œ</title>
    <!-- Firebase App (ê¸°ë³¸ SDK) -->
    <script src="https://www.gstatic.com/firebasejs/11.3.1/firebase-app.js"></script>
    <!-- Firebase Realtime Database SDK -->
    <script src="https://www.gstatic.com/firebasejs/11.3.1/firebase-database.js"></script>
</head>
<body>
    <h1>ğŸ½ ì¶”ì²œ ë§›ì§‘ ëª©ë¡</h1>

    <div>
        <input type="text" id="title" placeholder="ë§›ì§‘ ì´ë¦„">
        <input type="text" id="content" placeholder="ë§›ì§‘ ì„¤ëª…">
        <input type="text" id="nickname" placeholder="ì‘ì„±ì">
        <input type="file" id="image" accept="image/*">
        <button onclick="submitPlace()">ë“±ë¡í•˜ê¸°</button>
    </div>

    <h2>ğŸ“‹ ë§›ì§‘ ëª©ë¡</h2>
    <div id="placesList"></div>

    <script>
        // Firebase êµ¬ì„± ê°ì²´ (Firebase ì½˜ì†”ì—ì„œ ë³µì‚¬í•œ ì •ë³´ë¥¼ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            databaseURL: "YOUR_DATABASE_URL",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Firebase ì´ˆê¸°í™”
        firebase.initializeApp(firebaseConfig);

        // Realtime Database ì°¸ì¡° ìƒì„±
        const database = firebase.database();

        // Cloudinary ì„¤ì •
        const CLOUD_NAME = "dddmgnzlu";
        const UPLOAD_PRESET = "firebase_uploads";

        // ì´ë¯¸ì§€ ì—…ë¡œë“œ í•¨ìˆ˜
        async function uploadToCloudinary(file) {
            const url = `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`;
            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', UPLOAD_PRESET);

            const response = await fetch(url, {
                method: 'POST',
                body: formData
            });

            const data = await response.json();
            return data.secure_url;
        }

        // ë§›ì§‘ ì¶”ì²œ ë“±ë¡ í•¨ìˆ˜
        async function submitPlace() {
            const title = document.getElementById("title").value.trim();
            const content = document.getElementById("content").value.trim();
            const nickname = document.getElementById("nickname").value.trim();
            const fileInput = document.getElementById("image");
            const file = fileInput.files[0];

            if (!title || !content || !nickname) {
                alert("ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            let imageUrl = "";
            if (file) {
                try {
                    imageUrl = await uploadToCloudinary(file);
                } catch (error) {
                    console.error("ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨:", error);
                    alert("ì´ë¯¸ì§€ ì—…ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                    return;
                }
            }

            const newPlaceRef = database.ref('places').push();
            newPlaceRef.set({
                title,
                content,
                nickname,
                imageUrl,
                date: new Date().toISOString()
            });

            // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById("title").value = "";
            document.getElementById("content").value = "";
            document.getElementById("nickname").value = "";
            document.getElementById("image").value = "";
        }

        // ë§›ì§‘ ëª©ë¡ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        database.ref('places').on('value', (snapshot) => {
            const placesList = document.getElementById("placesList");
            placesList.innerHTML = ""; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”

            snapshot.forEach((childSnapshot) => {
                const place = childSnapshot.val();
                const placeDiv = document.createElement("div");
                placeDiv.innerHTML = `
                    <h3>${place.title}</h3>
                    <p>${place.content}</p>
                    <p>ì‘ì„±ì: ${place.nickname}</p>
                    <p>ë“±ë¡ì¼: ${new Date(place.date).toLocaleString()}</p>
                    ${place.imageUrl ? `<img src="${place.imageUrl}" alt="${place.title}" style="max-width: 200px;">` : ""}
                    <button onclick="deletePlace('${childSnapshot.key}')">ì‚­ì œí•˜ê¸°</button>
                `;
                placesList.appendChild(placeDiv);
            });
        });

        // ë§›ì§‘ ì¶”ì²œ ì‚­ì œ í•¨ìˆ˜
        function deletePlace(placeId) {
            if (confirm("ì •ë§ë¡œ ì´ ë§›ì§‘ ì¶”ì²œì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                database.ref('places/' + placeId).remove();
            }
        }
    </script>
</body>
</html>
